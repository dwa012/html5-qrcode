!function($){jQuery.fn.extend({html5_qrcode:function(qrcodeSuccess,qrcodeError,videoError){return this.each(function(){var currentElem=$(this),worker=$.data(currentElem[0],"worker")||new Worker("jsqrcode-combined.min.js");$.data(currentElem[0],"worker",worker);var height=currentElem.height(),width=currentElem.width();null==height&&(height=250),null==width&&(width=300);var localMediaStream,vidElem=$('<video width="'+width+'px" height="'+height+'px"></video>').appendTo(currentElem),canvasElem=$('<canvas id="qr-canvas" width="'+(width-2)+'px" height="'+(height-2)+'px" style="display:none;"></canvas>').appendTo(currentElem),video=vidElem[0],canvas=canvasElem[0],context=canvas.getContext("2d"),scan=function(){localMediaStream?(context.drawImage(video,0,0,307,250),worker.postMessage(context.getImageData(0,0,width,height))):requestAnimationFrame(scan)};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,300)};var successCallback=function(stream){video.src=window.URL&&window.URL.createObjectURL(stream)||stream,localMediaStream=stream,$.data(currentElem[0],"stream",stream),video.play(),requestAnimationFrame(scan)};navigator.getUserMedia?navigator.getUserMedia({video:!0},successCallback,function(error){videoError(error,localMediaStream)}):console.log("Native web camera streaming (getUserMedia) not supported in this browser."),worker.addEventListener("message",function(e){var data=e.data;0===data.indexOf("data:")?qrcodeSuccess(data.substring(5),localMediaStream):0===data.indexOf("error:")&&qrcodeError(data.substring(6),localMediaStream),requestAnimationFrame(scan)},!1)})},html5_qrcode_stop:function(){return this.each(function(){$(this).data("stream").getVideoTracks().forEach(function(videoTrack){videoTrack.stop()}),clearTimeout($(this).data("timeout"))})}})}(jQuery);